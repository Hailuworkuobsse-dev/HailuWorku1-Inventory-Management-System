var X=Object.defineProperty;var R=r=>{throw TypeError(r)};var ee=(r,e,t)=>e in r?X(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var $=(r,e,t)=>ee(r,typeof e!="symbol"?e+"":e,t),A=(r,e,t)=>e.has(r)||R("Cannot "+t);var n=(r,e,t)=>(A(r,e,"read from private field"),t?t.call(r):e.get(r)),M=(r,e,t)=>e.has(r)?R("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),k=(r,e,t,i)=>(A(r,e,"write to private field"),i?i.call(r,t):e.set(r,t),t),w=(r,e,t)=>(A(r,e,"access private method"),t);import{i as te,s as se,k as F,l as ae,n as G,m as V,r as d,o as re,p as ie,c as P,a as m,u as ne,j as s,h as le,q as oe,t as K}from"./index-NFMAM1pk.js";import{u as ce}from"./useQuery-DRajU14e.js";import{a as he,S as de,B as S,C as q,I as ue,b as U,D as me,M as pe}from"./DataTable-B_ylW1bo.js";import{E as ye}from"./eye-BuObglMq.js";var y,b,c,g,x,O,I,H,ge=(H=class extends te{constructor(e,t){super();M(this,x);M(this,y);M(this,b);M(this,c);M(this,g);k(this,y,e),this.setOptions(t),this.bindMethods(),w(this,x,O).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var i;const t=this.options;this.options=n(this,y).defaultMutationOptions(e),se(this.options,t)||n(this,y).getMutationCache().notify({type:"observerOptionsUpdated",mutation:n(this,c),observer:this}),t!=null&&t.mutationKey&&this.options.mutationKey&&F(t.mutationKey)!==F(this.options.mutationKey)?this.reset():((i=n(this,c))==null?void 0:i.state.status)==="pending"&&n(this,c).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=n(this,c))==null||e.removeObserver(this)}onMutationUpdate(e){w(this,x,O).call(this),w(this,x,I).call(this,e)}getCurrentResult(){return n(this,b)}reset(){var e;(e=n(this,c))==null||e.removeObserver(this),k(this,c,void 0),w(this,x,O).call(this),w(this,x,I).call(this)}mutate(e,t){var i;return k(this,g,t),(i=n(this,c))==null||i.removeObserver(this),k(this,c,n(this,y).getMutationCache().build(n(this,y),this.options)),n(this,c).addObserver(this),n(this,c).execute(e)}},y=new WeakMap,b=new WeakMap,c=new WeakMap,g=new WeakMap,x=new WeakSet,O=function(){var t;const e=((t=n(this,c))==null?void 0:t.state)??ae();k(this,b,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},I=function(e){G.batch(()=>{var t,i,o,l,u,C,E,f;if(n(this,g)&&this.hasListeners()){const h=n(this,b).variables,j=n(this,b).context,v={client:n(this,y),meta:this.options.meta,mutationKey:this.options.mutationKey};if((e==null?void 0:e.type)==="success"){try{(i=(t=n(this,g)).onSuccess)==null||i.call(t,e.data,h,j,v)}catch(p){Promise.reject(p)}try{(l=(o=n(this,g)).onSettled)==null||l.call(o,e.data,null,h,j,v)}catch(p){Promise.reject(p)}}else if((e==null?void 0:e.type)==="error"){try{(C=(u=n(this,g)).onError)==null||C.call(u,e.error,h,j,v)}catch(p){Promise.reject(p)}try{(f=(E=n(this,g)).onSettled)==null||f.call(E,void 0,e.error,h,j,v)}catch(p){Promise.reject(p)}}}this.listeners.forEach(h=>{h(n(this,b))})})},H);function xe(r,e){const t=V(),[i]=d.useState(()=>new ge(t,r));d.useEffect(()=>{i.setOptions(r)},[i,r]);const o=d.useSyncExternalStore(d.useCallback(u=>i.subscribe(G.batchCalls(u)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),l=d.useCallback((u,C)=>{i.mutate(u,C).catch(re)},[i]);if(o.error&&ie(i.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:l,mutateAsync:o.mutate}}/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=P("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=P("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=P("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=P("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=P("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.309.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=P("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);class Ne{constructor(){$(this,"basePath","/materials")}async getAll(e){const t=new URLSearchParams;return e&&Object.entries(e).forEach(([o,l])=>{l!==void 0&&l!==""&&t.append(o,String(l))}),(await m.get(`${this.basePath}?${t.toString()}`)).data}async getById(e){return(await m.get(`${this.basePath}/${e}`)).data}async create(e){return(await m.post(this.basePath,e)).data}async update(e,t){return(await m.patch(`${this.basePath}/${e}`,t)).data}async delete(e){await m.delete(`${this.basePath}/${e}`)}async getCategories(){return(await m.get(`${this.basePath}/categories`)).data}async getStockLevel(e){return(await m.get(`${this.basePath}/${e}/stock-level`)).data}async getLowStockMaterials(){return(await m.get(`${this.basePath}/low-stock`)).data}async exportToExcel(e){const t=new URLSearchParams;return e&&Object.entries(e).forEach(([o,l])=>{l!==void 0&&l!==""&&t.append(o,String(l))}),(await m.get(`${this.basePath}/export?${t.toString()}`,{responseType:"blob"})).data}async importFromExcel(e){const t=new FormData;return t.append("file",e),(await m.post(`${this.basePath}/import`,t,{headers:{"Content-Type":"multipart/form-data"}})).data}}const B=new Ne,Me=()=>{const r=ne(),e=V(),[t,i]=d.useState({page:1,limit:10}),[o,l]=d.useState(""),[u,C]=d.useState(!1),[E,f]=d.useState(!1),[h,j]=d.useState(null),{data:v,isLoading:p}=ce({queryKey:["materials",t],queryFn:()=>B.getAll(t)}),L=xe({mutationFn:a=>B.delete(a),onSuccess:()=>{K.success("Material deleted","The material has been successfully deleted."),e.invalidateQueries({queryKey:["materials"]}),f(!1),j(null)},onError:()=>{K.error("Delete failed","Failed to delete the material. Please try again.")}}),Q=a=>{l(a),i(N=>({...N,search:a,page:1}))},D=(a,N)=>{i(T=>({...T,[a]:N||void 0,page:1}))},z=a=>{j(a),f(!0)},W=()=>{h&&L.mutate(h.id)},Y=d.useMemo(()=>[{accessorKey:"code",header:"Code",cell:({row:a})=>s.jsx("span",{className:"font-mono text-sm text-gray-600",children:a.original.code})},{accessorKey:"name",header:"Name",cell:({row:a})=>s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-900",children:a.original.name}),a.original.description&&s.jsx("p",{className:"text-sm text-gray-500 truncate max-w-xs",children:a.original.description})]})},{accessorKey:"category",header:"Category",cell:({row:a})=>s.jsx(he,{variant:"info",size:"sm",children:a.original.category})},{accessorKey:"unit",header:"Unit"},{accessorKey:"unitPrice",header:"Unit Price",cell:({row:a})=>s.jsx("span",{className:"font-medium",children:a.original.unitPrice?le(a.original.unitPrice):"-"})},{accessorKey:"currentStock",header:"Current Stock",cell:({row:a})=>{const N=a.original.currentStock||0,T=a.original.reorderPoint||0,J=N<=T;return s.jsxs("span",{className:J?"text-red-600 font-medium":"",children:[N," ",a.original.unit]})}},{accessorKey:"status",header:"Status",cell:({row:a})=>s.jsx(de,{status:a.original.status})},{id:"actions",header:"",cell:({row:a})=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>r(`/materials/${a.original.id}`),className:"p-1.5 text-gray-500 hover:text-primary-600 hover:bg-gray-100 rounded-lg transition-colors",title:"View",children:s.jsx(ye,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>r(`/materials/${a.original.id}/edit`),className:"p-1.5 text-gray-500 hover:text-primary-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Edit",children:s.jsx(je,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>z(a.original),className:"p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete",children:s.jsx(Se,{className:"w-4 h-4"})})]})}],[r]),Z=[{value:"",label:"All Categories"},{value:"CEMENT",label:"Cement"},{value:"STEEL",label:"Steel"},{value:"AGGREGATE",label:"Aggregate"},{value:"TIMBER",label:"Timber"},{value:"ELECTRICAL",label:"Electrical"},{value:"PLUMBING",label:"Plumbing"},{value:"FINISHING",label:"Finishing"},{value:"HARDWARE",label:"Hardware"},{value:"SAFETY",label:"Safety"},{value:"OTHER",label:"Other"}],_=[{value:"",label:"All Statuses"},{value:"ACTIVE",label:"Active"},{value:"DRAFT",label:"Draft"},{value:"OBSOLETE",label:"Obsolete"},{value:"PENDING_APPROVAL",label:"Pending Approval"}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Materials"}),s.jsx("p",{className:"text-gray-500 mt-1",children:"Manage your material inventory"})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(S,{variant:"outline",leftIcon:s.jsx(ve,{className:"w-4 h-4"}),children:"Export"}),s.jsx(S,{variant:"outline",leftIcon:s.jsx(Ce,{className:"w-4 h-4"}),children:"Import"}),s.jsx(S,{leftIcon:s.jsx(fe,{className:"w-4 h-4"}),onClick:()=>r("/materials/new"),children:"Add Material"})]})]}),s.jsxs(q,{className:"p-4",children:[s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsx(ue,{placeholder:"Search materials by name or code...",value:o,onChange:a=>Q(a.target.value),leftIcon:s.jsx(oe,{className:"w-4 h-4"})})}),s.jsx(S,{variant:u?"primary":"outline",onClick:()=>C(!u),leftIcon:s.jsx(be,{className:"w-4 h-4"}),children:"Filters"})]}),u&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsx(U,{label:"Category",value:t.category||"",onChange:a=>D("category",a),options:Z}),s.jsx(U,{label:"Status",value:t.status||"",onChange:a=>D("status",a),options:_}),s.jsx("div",{className:"flex items-end",children:s.jsx(S,{variant:"ghost",onClick:()=>{i({page:1,limit:10}),l("")},children:"Clear Filters"})})]})]}),s.jsx(q,{children:s.jsx(me,{data:(v==null?void 0:v.data)||[],columns:Y,isLoading:p,emptyMessage:"No materials found. Create your first material to get started.",onRowClick:a=>r(`/materials/${a.id}`)})}),s.jsx(pe,{isOpen:E,onClose:()=>f(!1),title:"Delete Material",size:"sm",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("p",{className:"text-gray-600",children:["Are you sure you want to delete"," ",s.jsx("span",{className:"font-medium text-gray-900",children:h==null?void 0:h.name}),"? This action cannot be undone."]}),s.jsxs("div",{className:"flex justify-end gap-3",children:[s.jsx(S,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),s.jsx(S,{variant:"danger",onClick:W,isLoading:L.isPending,children:"Delete"})]})]})})]})};Me.displayName="MaterialsListPage";export{Me as MaterialsListPage};
